<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>TermIndexedByNormalType.Evaluation</title><link rel="stylesheet" href="Agda.css"></head><body><pre>\begin{code}
<a id="14" class="Keyword">module</a> <a id="21" href="TermIndexedByNormalType.Evaluation.html" class="Module">TermIndexedByNormalType.Evaluation</a> <a id="56" class="Keyword">where</a>
\end{code}<a id="72" class="Comment">

## Imports

</a>\begin{code}
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Type.html" class="Module">Type</a>
<a id="116" class="Keyword">open</a> <a id="121" class="Keyword">import</a> <a id="128" href="Type.BetaNormal.html" class="Module">Type.BetaNormal</a>
<a id="144" class="Keyword">open</a> <a id="149" class="Keyword">import</a> <a id="156" href="TermIndexedByNormalType.Term.html" class="Module">TermIndexedByNormalType.Term</a>
<a id="185" class="Keyword">open</a> <a id="190" class="Keyword">import</a> <a id="197" href="TermIndexedByNormalType.Term.Reduction.html" class="Module">TermIndexedByNormalType.Term.Reduction</a>
\end{code}<a id="246" class="Comment">

## Evaluation

As previously, gas is specified by a natural number.
</a>\begin{code}
<a id="329" class="Keyword">open</a> <a id="334" class="Keyword">import</a> <a id="341" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="350" class="Keyword">data</a> <a id="Gas"></a><a id="355" href="TermIndexedByNormalType.Evaluation.html#355" class="Datatype">Gas</a> <a id="359" class="Symbol">:</a> <a id="361" class="PrimitiveType">Set</a> <a id="365" class="Keyword">where</a>
  <a id="Gas.gas"></a><a id="373" href="TermIndexedByNormalType.Evaluation.html#373" class="InductiveConstructor">gas</a> <a id="377" class="Symbol">:</a> <a id="379" href="Agda.Builtin.Nat.html#97" class="Datatype">ℕ</a> <a id="381" class="Symbol">→</a> <a id="383" href="TermIndexedByNormalType.Evaluation.html#355" class="Datatype">Gas</a>
\end{code}<a id="397" class="Comment">
When our evaluator returns a term `N`, it will either give evidence that
`N` is a value or indicate that it ran out of gas.
</a>\begin{code}
<a id="535" class="Keyword">data</a> <a id="Finished"></a><a id="540" href="TermIndexedByNormalType.Evaluation.html#540" class="Datatype">Finished</a> <a id="549" class="Symbol">{</a><a id="550" href="TermIndexedByNormalType.Evaluation.html#550" class="Bound">Γ</a> <a id="552" href="TermIndexedByNormalType.Evaluation.html#552" class="Bound">J</a><a id="553" class="Symbol">}{</a><a id="555" href="TermIndexedByNormalType.Evaluation.html#555" class="Bound">A</a> <a id="557" class="Symbol">:</a> <a id="559" href="TermIndexedByNormalType.Term.html#647" class="Function Operator">∥</a> <a id="561" href="TermIndexedByNormalType.Evaluation.html#550" class="Bound">Γ</a> <a id="563" href="TermIndexedByNormalType.Term.html#647" class="Function Operator">∥</a> <a id="565" href="Type.BetaNormal.html#828" class="Datatype Operator">⊢Nf⋆</a> <a id="570" href="TermIndexedByNormalType.Evaluation.html#552" class="Bound">J</a><a id="571" class="Symbol">}</a> <a id="573" class="Symbol">:</a>  <a id="576" class="Symbol">(</a><a id="577" href="TermIndexedByNormalType.Evaluation.html#577" class="Bound">N</a> <a id="579" class="Symbol">:</a> <a id="581" href="TermIndexedByNormalType.Evaluation.html#550" class="Bound">Γ</a> <a id="583" href="TermIndexedByNormalType.Term.html#1819" class="Datatype Operator">⊢</a> <a id="585" href="TermIndexedByNormalType.Evaluation.html#555" class="Bound">A</a><a id="586" class="Symbol">)</a> <a id="588" class="Symbol">→</a>  <a id="591" class="PrimitiveType">Set</a> <a id="595" class="Keyword">where</a>

   <a id="Finished.done"></a><a id="605" href="TermIndexedByNormalType.Evaluation.html#605" class="InductiveConstructor">done</a> <a id="610" class="Symbol">:</a> <a id="612" class="Symbol">∀</a> <a id="614" href="TermIndexedByNormalType.Evaluation.html#614" class="Bound">N</a> <a id="616" class="Symbol">→</a> 
       <a id="626" href="TermIndexedByNormalType.Term.Reduction.html#576" class="Datatype">Value</a> <a id="632" href="TermIndexedByNormalType.Evaluation.html#614" class="Bound">N</a>
       <a id="641" class="Comment">----------</a>
     <a id="657" class="Symbol">→</a> <a id="659" href="TermIndexedByNormalType.Evaluation.html#540" class="Datatype">Finished</a> <a id="668" href="TermIndexedByNormalType.Evaluation.html#614" class="Bound">N</a>

   <a id="Finished.out-of-gas"></a><a id="674" href="TermIndexedByNormalType.Evaluation.html#674" class="InductiveConstructor">out-of-gas</a> <a id="685" class="Symbol">:</a> <a id="687" class="Symbol">∀{</a><a id="689" href="TermIndexedByNormalType.Evaluation.html#689" class="Bound">N</a><a id="690" class="Symbol">}</a> <a id="692" class="Symbol">→</a> 
       <a id="702" class="Comment">----------</a>
       <a id="720" href="TermIndexedByNormalType.Evaluation.html#540" class="Datatype">Finished</a> <a id="729" href="TermIndexedByNormalType.Evaluation.html#689" class="Bound">N</a>
\end{code}<a id="741" class="Comment">
Given a term `L` of type `A`, the evaluator will, for some `N`, return
a reduction sequence from `L` to `N` and an indication of whether
reduction finished.
</a>\begin{code}
<a id="912" class="Keyword">data</a> <a id="Steps"></a><a id="917" href="TermIndexedByNormalType.Evaluation.html#917" class="Datatype">Steps</a> <a id="923" class="Symbol">:</a> <a id="925" class="Symbol">∀</a> <a id="927" class="Symbol">{</a><a id="928" href="TermIndexedByNormalType.Evaluation.html#928" class="Bound">J</a><a id="929" class="Symbol">}{</a><a id="931" href="TermIndexedByNormalType.Evaluation.html#931" class="Bound">A</a> <a id="933" class="Symbol">:</a> <a id="935" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="937" href="Type.BetaNormal.html#828" class="Datatype Operator">⊢Nf⋆</a> <a id="942" href="TermIndexedByNormalType.Evaluation.html#928" class="Bound">J</a><a id="943" class="Symbol">}</a> <a id="945" class="Symbol">→</a> <a id="947" href="TermIndexedByNormalType.Term.html#842" class="InductiveConstructor">∅</a> <a id="949" href="TermIndexedByNormalType.Term.html#1819" class="Datatype Operator">⊢</a> <a id="951" href="TermIndexedByNormalType.Evaluation.html#931" class="Bound">A</a> <a id="953" class="Symbol">→</a> <a id="955" class="PrimitiveType">Set</a> <a id="959" class="Keyword">where</a>

  <a id="Steps.steps"></a><a id="968" href="TermIndexedByNormalType.Evaluation.html#968" class="InductiveConstructor">steps</a> <a id="974" class="Symbol">:</a> <a id="976" class="Symbol">∀</a> <a id="978" class="Symbol">{</a><a id="979" href="TermIndexedByNormalType.Evaluation.html#979" class="Bound">J</a><a id="980" class="Symbol">}{</a><a id="982" href="TermIndexedByNormalType.Evaluation.html#982" class="Bound">A</a> <a id="984" class="Symbol">:</a> <a id="986" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="988" href="Type.BetaNormal.html#828" class="Datatype Operator">⊢Nf⋆</a> <a id="993" href="TermIndexedByNormalType.Evaluation.html#979" class="Bound">J</a><a id="994" class="Symbol">}</a> <a id="996" class="Symbol">{</a><a id="997" href="TermIndexedByNormalType.Evaluation.html#997" class="Bound">L</a> <a id="999" href="TermIndexedByNormalType.Evaluation.html#999" class="Bound">N</a> <a id="1001" class="Symbol">:</a> <a id="1003" href="TermIndexedByNormalType.Term.html#842" class="InductiveConstructor">∅</a> <a id="1005" href="TermIndexedByNormalType.Term.html#1819" class="Datatype Operator">⊢</a> <a id="1007" href="TermIndexedByNormalType.Evaluation.html#982" class="Bound">A</a><a id="1008" class="Symbol">}</a>
    <a id="1014" class="Symbol">→</a> <a id="1016" href="TermIndexedByNormalType.Evaluation.html#997" class="Bound">L</a> <a id="1018" href="TermIndexedByNormalType.Term.Reduction.html#2150" class="Datatype Operator">—↠</a> <a id="1021" href="TermIndexedByNormalType.Evaluation.html#999" class="Bound">N</a>
    <a id="1027" class="Symbol">→</a> <a id="1029" href="TermIndexedByNormalType.Evaluation.html#540" class="Datatype">Finished</a> <a id="1038" href="TermIndexedByNormalType.Evaluation.html#999" class="Bound">N</a>
      <a id="1046" class="Comment">----------</a>
    <a id="1061" class="Symbol">→</a> <a id="1063" href="TermIndexedByNormalType.Evaluation.html#917" class="Datatype">Steps</a> <a id="1069" href="TermIndexedByNormalType.Evaluation.html#997" class="Bound">L</a>

\end{code}<a id="1082" class="Comment">
The evaluator takes gas and a term and returns the corresponding steps.
</a>\begin{code}
<a id="eval"></a><a id="1168" href="TermIndexedByNormalType.Evaluation.html#1168" class="Function">eval</a> <a id="1173" class="Symbol">:</a> <a id="1175" class="Symbol">∀</a> <a id="1177" class="Symbol">{</a><a id="1178" href="TermIndexedByNormalType.Evaluation.html#1178" class="Bound">A</a> <a id="1180" class="Symbol">:</a> <a id="1182" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1184" href="Type.BetaNormal.html#828" class="Datatype Operator">⊢Nf⋆</a> <a id="1189" href="Type.html#580" class="InductiveConstructor">*</a><a id="1190" class="Symbol">}</a>
  <a id="1194" class="Symbol">→</a> <a id="1196" href="TermIndexedByNormalType.Evaluation.html#355" class="Datatype">Gas</a>
  <a id="1202" class="Symbol">→</a> <a id="1204" class="Symbol">(</a><a id="1205" href="TermIndexedByNormalType.Evaluation.html#1205" class="Bound">M</a> <a id="1207" class="Symbol">:</a> <a id="1209" href="TermIndexedByNormalType.Term.html#842" class="InductiveConstructor">∅</a> <a id="1211" href="TermIndexedByNormalType.Term.html#1819" class="Datatype Operator">⊢</a> <a id="1213" href="TermIndexedByNormalType.Evaluation.html#1178" class="Bound">A</a><a id="1214" class="Symbol">)</a>
    <a id="1220" class="Comment">-----------</a>
  <a id="1234" class="Symbol">→</a> <a id="1236" href="TermIndexedByNormalType.Evaluation.html#917" class="Datatype">Steps</a> <a id="1242" href="TermIndexedByNormalType.Evaluation.html#1205" class="Bound">M</a>
<a id="1244" href="TermIndexedByNormalType.Evaluation.html#1168" class="Function">eval</a> <a id="1249" class="Symbol">(</a><a id="1250" href="TermIndexedByNormalType.Evaluation.html#373" class="InductiveConstructor">gas</a> <a id="1254" href="Agda.Builtin.Nat.html#115" class="InductiveConstructor">zero</a><a id="1258" class="Symbol">)</a> <a id="1260" href="TermIndexedByNormalType.Evaluation.html#1260" class="Bound">M</a> <a id="1262" class="Symbol">=</a> <a id="1264" href="TermIndexedByNormalType.Evaluation.html#968" class="InductiveConstructor">steps</a> <a id="1270" href="TermIndexedByNormalType.Term.Reduction.html#2237" class="InductiveConstructor">refl—↠</a> <a id="1277" href="TermIndexedByNormalType.Evaluation.html#674" class="InductiveConstructor">out-of-gas</a>
<a id="1288" href="TermIndexedByNormalType.Evaluation.html#1168" class="Function">eval</a> <a id="1293" class="Symbol">(</a><a id="1294" href="TermIndexedByNormalType.Evaluation.html#373" class="InductiveConstructor">gas</a> <a id="1298" class="Symbol">(</a><a id="1299" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1303" href="TermIndexedByNormalType.Evaluation.html#1303" class="Bound">n</a><a id="1304" class="Symbol">))</a> <a id="1307" href="TermIndexedByNormalType.Evaluation.html#1307" class="Bound">M</a> <a id="1309" class="Keyword">with</a> <a id="1314" href="TermIndexedByNormalType.Term.Reduction.html#2631" class="Function">progress</a> <a id="1323" href="TermIndexedByNormalType.Evaluation.html#1307" class="Bound">M</a>
<a id="1325" href="TermIndexedByNormalType.Evaluation.html#1168" class="Function">eval</a> <a id="1330" class="Symbol">(</a><a id="1331" href="TermIndexedByNormalType.Evaluation.html#373" class="InductiveConstructor">gas</a> <a id="1335" class="Symbol">(</a><a id="1336" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1340" href="TermIndexedByNormalType.Evaluation.html#1340" class="Bound">n</a><a id="1341" class="Symbol">))</a> <a id="1344" href="TermIndexedByNormalType.Evaluation.html#1344" class="Bound">M</a> <a id="1346" class="Symbol">|</a> <a id="1348" href="TermIndexedByNormalType.Term.Reduction.html#2487" class="InductiveConstructor">step</a> <a id="1353" class="Symbol">{</a><a id="1354" href="TermIndexedByNormalType.Evaluation.html#1354" class="Bound">N</a><a id="1355" class="Symbol">}</a> <a id="1357" href="TermIndexedByNormalType.Evaluation.html#1357" class="Bound">p</a>  <a id="1360" class="Keyword">with</a> <a id="1365" href="TermIndexedByNormalType.Evaluation.html#1168" class="Function">eval</a> <a id="1370" class="Symbol">(</a><a id="1371" href="TermIndexedByNormalType.Evaluation.html#373" class="InductiveConstructor">gas</a> <a id="1375" href="TermIndexedByNormalType.Evaluation.html#1340" class="Bound">n</a><a id="1376" class="Symbol">)</a> <a id="1378" href="TermIndexedByNormalType.Evaluation.html#1354" class="Bound">N</a>
<a id="1380" href="TermIndexedByNormalType.Evaluation.html#1168" class="Function">eval</a> <a id="1385" class="Symbol">(</a><a id="1386" href="TermIndexedByNormalType.Evaluation.html#373" class="InductiveConstructor">gas</a> <a id="1390" class="Symbol">(</a><a id="1391" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1395" href="TermIndexedByNormalType.Evaluation.html#1395" class="Bound">n</a><a id="1396" class="Symbol">))</a> <a id="1399" href="TermIndexedByNormalType.Evaluation.html#1399" class="Bound">M</a> <a id="1401" class="Symbol">|</a> <a id="1403" href="TermIndexedByNormalType.Term.Reduction.html#2487" class="InductiveConstructor">step</a> <a id="1408" class="Symbol">{</a><a id="1409" href="TermIndexedByNormalType.Evaluation.html#1409" class="Bound">N</a><a id="1410" class="Symbol">}</a> <a id="1412" href="TermIndexedByNormalType.Evaluation.html#1412" class="Bound">p</a> <a id="1414" class="Symbol">|</a> <a id="1416" href="TermIndexedByNormalType.Evaluation.html#968" class="InductiveConstructor">steps</a> <a id="1422" href="TermIndexedByNormalType.Evaluation.html#1422" class="Bound">ps</a> <a id="1425" href="TermIndexedByNormalType.Evaluation.html#1425" class="Bound">q</a> <a id="1427" class="Symbol">=</a> <a id="1429" href="TermIndexedByNormalType.Evaluation.html#968" class="InductiveConstructor">steps</a> <a id="1435" class="Symbol">(</a><a id="1436" href="TermIndexedByNormalType.Term.Reduction.html#2293" class="InductiveConstructor">trans—↠</a> <a id="1444" href="TermIndexedByNormalType.Evaluation.html#1412" class="Bound">p</a> <a id="1446" href="TermIndexedByNormalType.Evaluation.html#1422" class="Bound">ps</a><a id="1448" class="Symbol">)</a> <a id="1450" href="TermIndexedByNormalType.Evaluation.html#1425" class="Bound">q</a>
<a id="1452" href="TermIndexedByNormalType.Evaluation.html#1168" class="Function">eval</a> <a id="1457" class="Symbol">(</a><a id="1458" href="TermIndexedByNormalType.Evaluation.html#373" class="InductiveConstructor">gas</a> <a id="1462" class="Symbol">(</a><a id="1463" href="Agda.Builtin.Nat.html#128" class="InductiveConstructor">suc</a> <a id="1467" href="TermIndexedByNormalType.Evaluation.html#1467" class="Bound">n</a><a id="1468" class="Symbol">))</a> <a id="1471" href="TermIndexedByNormalType.Evaluation.html#1471" class="Bound">M</a> <a id="1473" class="Symbol">|</a> <a id="1475" href="TermIndexedByNormalType.Term.Reduction.html#2551" class="InductiveConstructor">done</a> <a id="1480" href="TermIndexedByNormalType.Evaluation.html#1480" class="Bound">vM</a> <a id="1483" class="Symbol">=</a> <a id="1485" href="TermIndexedByNormalType.Evaluation.html#968" class="InductiveConstructor">steps</a> <a id="1491" href="TermIndexedByNormalType.Term.Reduction.html#2237" class="InductiveConstructor">refl—↠</a> <a id="1498" class="Symbol">(</a><a id="1499" href="TermIndexedByNormalType.Evaluation.html#605" class="InductiveConstructor">done</a> <a id="1504" class="Symbol">_</a> <a id="1506" href="TermIndexedByNormalType.Evaluation.html#1480" class="Bound">vM</a><a id="1508" class="Symbol">)</a>
\end{code}<a id="1520" class="Comment">
</a></pre></body></html>