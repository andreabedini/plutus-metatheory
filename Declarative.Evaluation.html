<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Declarative.Evaluation</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Markup">\begin{code}</a>
<a id="14" class="Keyword">module</a> <a id="21" href="Declarative.Evaluation.html" class="Module">Declarative.Evaluation</a> <a id="44" class="Keyword">where</a>
<a id="50" class="Markup">\end{code}</a><a id="60" class="Background">

## Imports

</a><a id="74" class="Markup">\begin{code}</a>
<a id="87" class="Keyword">open</a> <a id="92" class="Keyword">import</a> <a id="99" href="Type.html" class="Module">Type</a>
<a id="104" class="Keyword">open</a> <a id="109" class="Keyword">import</a> <a id="116" href="Declarative.html" class="Module">Declarative</a>
<a id="128" class="Keyword">open</a> <a id="133" class="Keyword">import</a> <a id="140" href="Declarative.Reduction.html" class="Module">Declarative.Reduction</a>
<a id="162" class="Markup">\end{code}</a><a id="172" class="Background">

## Evaluation

Transitive closure of reduction
</a><a id="221" class="Markup">\begin{code}</a>
<a id="234" class="Comment">{-
data _—↠_ {J Γ}{A : ∥ Γ ∥ ⊢⋆ J} (L : Γ ⊢ A) : (Γ ⊢ A) → Set where
  done : L —↠ L
  continue : ∀ {M N} → L —→ M → M —↠ N → L —↠ N  
-}</a>
<a id="372" class="Markup">\end{code}</a><a id="382" class="Background">

As previously, gas is specified by a natural number.
</a><a id="437" class="Markup">\begin{code}</a>
<a id="450" class="Keyword">open</a> <a id="455" class="Keyword">import</a> <a id="462" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="471" class="Keyword">data</a> <a id="Gas"></a><a id="476" href="Declarative.Evaluation.html#476" class="Datatype">Gas</a> <a id="480" class="Symbol">:</a> <a id="482" class="PrimitiveType">Set</a> <a id="486" class="Keyword">where</a>
  <a id="Gas.gas"></a><a id="494" href="Declarative.Evaluation.html#494" class="InductiveConstructor">gas</a> <a id="498" class="Symbol">:</a> <a id="500" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="502" class="Symbol">→</a> <a id="504" href="Declarative.Evaluation.html#476" class="Datatype">Gas</a>
<a id="508" class="Markup">\end{code}</a><a id="518" class="Background">
When our evaluator returns a term `N`, it will either give evidence that
`N` is a value or indicate that it ran out of gas.
</a><a id="643" class="Markup">\begin{code}</a>
<a id="656" class="Comment">{-
data Finished {Γ J}{A : ∥ Γ ∥ ⊢⋆ J} :  (N : Γ ⊢ A) →  Set where

   done : ∀ N → 
       Value N
       ----------
     → Finished N

   out-of-gas : ∀{N} → 
       ----------
       Finished N
-}</a>
<a id="856" class="Markup">\end{code}</a><a id="866" class="Background">
Given a term `L` of type `A`, the evaluator will, for some `N`, return
a reduction sequence from `L` to `N` and an indication of whether
reduction finished.
</a><a id="1024" class="Markup">\begin{code}</a>
<a id="1037" class="Comment">{-
data Steps : ∀ {J}{A : ∅ ⊢⋆ J} → ∅ ⊢ A → Set where

  steps : ∀ {J}{A : ∅ ⊢⋆ J} {L N : ∅ ⊢ A}
    → L —↠ N
    → Finished N
      ----------
    → Steps L

  error :  ∀ {J}{A : ∅ ⊢⋆ J} {L : ∅ ⊢ A} → Steps L
-}</a>
<a id="1250" class="Markup">\end{code}</a><a id="1260" class="Background">
The evaluator takes gas and a term and returns the corresponding steps.
</a><a id="1333" class="Markup">\begin{code}</a>
<a id="1346" class="Comment">{-
eval : ∀ {A : ∅ ⊢⋆ *}
  → Gas
  → (M : ∅ ⊢ A)
    -----------
  → Steps M
eval (gas zero) M = steps done out-of-gas
eval (gas (suc n)) M with progress M
...                  | error = error
eval (gas (suc n)) M | step {N} p  with eval (gas n) N
...                               | error = error
eval (gas (suc n)) M | step {N} p | steps ps q = steps (continue p ps) q
eval (gas (suc n)) M | done vM = steps done (done _ vM)
-}</a>
<a id="1776" class="Markup">\end{code}</a><a id="1786" class="Background">
</a></pre></body></html>