<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Algorithmic.Evaluation</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Markup">\begin{code}</a>
<a id="14" class="Keyword">module</a> <a id="21" href="Algorithmic.Evaluation.html" class="Module">Algorithmic.Evaluation</a> <a id="44" class="Keyword">where</a>
<a id="50" class="Markup">\end{code}</a><a id="60" class="Background">

## Imports

</a><a id="74" class="Markup">\begin{code}</a>
<a id="87" class="Keyword">open</a> <a id="92" class="Keyword">import</a> <a id="99" href="Type.html" class="Module">Type</a>
<a id="104" class="Keyword">open</a> <a id="109" class="Keyword">import</a> <a id="116" href="Type.BetaNormal.html" class="Module">Type.BetaNormal</a>
<a id="132" class="Keyword">open</a> <a id="137" class="Keyword">import</a> <a id="144" href="Algorithmic.html" class="Module">Algorithmic</a>
<a id="156" class="Keyword">open</a> <a id="161" class="Keyword">import</a> <a id="168" href="Algorithmic.Reduction.html" class="Module">Algorithmic.Reduction</a>
<a id="190" class="Markup">\end{code}</a><a id="200" class="Background">

## Evaluation

As previously, gas is specified by a natural number.
</a><a id="270" class="Markup">\begin{code}</a>
<a id="283" class="Keyword">open</a> <a id="288" class="Keyword">import</a> <a id="295" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="304" class="Keyword">data</a> <a id="Gas"></a><a id="309" href="Algorithmic.Evaluation.html#309" class="Datatype">Gas</a> <a id="313" class="Symbol">:</a> <a id="315" class="PrimitiveType">Set</a> <a id="319" class="Keyword">where</a>
  <a id="Gas.gas"></a><a id="327" href="Algorithmic.Evaluation.html#327" class="InductiveConstructor">gas</a> <a id="331" class="Symbol">:</a> <a id="333" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="335" class="Symbol">→</a> <a id="337" href="Algorithmic.Evaluation.html#309" class="Datatype">Gas</a>
<a id="341" class="Markup">\end{code}</a><a id="351" class="Background">
When our evaluator returns a term `N`, it will either give evidence that
`N` is a value or indicate that it ran out of gas.
</a><a id="476" class="Markup">\begin{code}</a>
<a id="489" class="Keyword">data</a> <a id="Finished"></a><a id="494" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="503" class="Symbol">{</a><a id="504" href="Algorithmic.Evaluation.html#504" class="Bound">A</a> <a id="506" class="Symbol">:</a> <a id="508" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="510" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="515" href="Type.html#615" class="InductiveConstructor">*</a><a id="516" class="Symbol">}</a> <a id="518" class="Symbol">:</a>  <a id="521" class="Symbol">(</a><a id="522" href="Algorithmic.Evaluation.html#522" class="Bound">N</a> <a id="524" class="Symbol">:</a> <a id="526" href="Algorithmic.html#1153" class="InductiveConstructor">∅</a> <a id="528" href="Algorithmic.html#2242" class="Datatype Operator">⊢</a> <a id="530" href="Algorithmic.Evaluation.html#504" class="Bound">A</a><a id="531" class="Symbol">)</a> <a id="533" class="Symbol">→</a>  <a id="536" class="PrimitiveType">Set</a> <a id="540" class="Keyword">where</a>

   <a id="Finished.done"></a><a id="550" href="Algorithmic.Evaluation.html#550" class="InductiveConstructor">done</a> <a id="555" class="Symbol">:</a> <a id="557" class="Symbol">∀</a> <a id="559" href="Algorithmic.Evaluation.html#559" class="Bound">N</a> <a id="561" class="Symbol">→</a> 
       <a id="571" href="Algorithmic.Reduction.html#1087" class="Datatype">Value</a> <a id="577" href="Algorithmic.Evaluation.html#559" class="Bound">N</a>
       <a id="586" class="Comment">----------</a>
     <a id="602" class="Symbol">→</a> <a id="604" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="613" href="Algorithmic.Evaluation.html#559" class="Bound">N</a>

   <a id="Finished.out-of-gas"></a><a id="619" href="Algorithmic.Evaluation.html#619" class="InductiveConstructor">out-of-gas</a> <a id="630" class="Symbol">:</a> <a id="632" class="Symbol">∀{</a><a id="634" href="Algorithmic.Evaluation.html#634" class="Bound">N</a><a id="635" class="Symbol">}</a> <a id="637" class="Symbol">→</a> 
       <a id="647" class="Comment">----------</a>
       <a id="665" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="674" href="Algorithmic.Evaluation.html#634" class="Bound">N</a>

   <a id="Finished.error"></a><a id="680" href="Algorithmic.Evaluation.html#680" class="InductiveConstructor">error</a> <a id="686" class="Symbol">:</a> <a id="688" class="Symbol">{</a><a id="689" href="Algorithmic.Evaluation.html#689" class="Bound">L</a> <a id="691" class="Symbol">:</a> <a id="693" href="Algorithmic.html#1153" class="InductiveConstructor">∅</a> <a id="695" href="Algorithmic.html#2242" class="Datatype Operator">⊢</a> <a id="697" href="Algorithmic.Evaluation.html#504" class="Bound">A</a><a id="698" class="Symbol">}</a> <a id="700" class="Symbol">→</a> <a id="702" href="Algorithmic.Reduction.html#1795" class="Datatype">Error</a> <a id="708" href="Algorithmic.Evaluation.html#689" class="Bound">L</a> <a id="710" class="Symbol">→</a> <a id="712" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="721" href="Algorithmic.Evaluation.html#689" class="Bound">L</a>

   <a id="727" class="Comment">-- is this actually possible?</a>
   <a id="Finished.neutral"></a><a id="760" href="Algorithmic.Evaluation.html#760" class="InductiveConstructor">neutral</a> <a id="768" class="Symbol">:</a> <a id="770" class="Symbol">{</a><a id="771" href="Algorithmic.Evaluation.html#771" class="Bound">L</a> <a id="773" class="Symbol">:</a> <a id="775" href="Algorithmic.html#1153" class="InductiveConstructor">∅</a> <a id="777" href="Algorithmic.html#2242" class="Datatype Operator">⊢</a> <a id="779" href="Algorithmic.Evaluation.html#504" class="Bound">A</a><a id="780" class="Symbol">}</a> <a id="782" class="Symbol">→</a> <a id="784" href="Algorithmic.Reduction.html#6333" class="Datatype">Neutral</a> <a id="792" href="Algorithmic.Evaluation.html#771" class="Bound">L</a> <a id="794" class="Symbol">→</a> <a id="796" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="805" href="Algorithmic.Evaluation.html#771" class="Bound">L</a>
<a id="807" class="Markup">\end{code}</a><a id="817" class="Background">
Given a term `L` of type `A`, the evaluator will, for some `N`, return
a reduction sequence from `L` to `N` and an indication of whether
reduction finished.
</a><a id="975" class="Markup">\begin{code}</a>
<a id="988" class="Keyword">data</a> <a id="Steps"></a><a id="993" href="Algorithmic.Evaluation.html#993" class="Datatype">Steps</a> <a id="999" class="Symbol">:</a> <a id="1001" class="Symbol">∀</a> <a id="1003" class="Symbol">{</a><a id="1004" href="Algorithmic.Evaluation.html#1004" class="Bound">A</a> <a id="1006" class="Symbol">:</a> <a id="1008" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1010" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1015" href="Type.html#615" class="InductiveConstructor">*</a><a id="1016" class="Symbol">}</a> <a id="1018" class="Symbol">→</a> <a id="1020" href="Algorithmic.html#1153" class="InductiveConstructor">∅</a> <a id="1022" href="Algorithmic.html#2242" class="Datatype Operator">⊢</a> <a id="1024" href="Algorithmic.Evaluation.html#1004" class="Bound">A</a> <a id="1026" class="Symbol">→</a> <a id="1028" class="PrimitiveType">Set</a> <a id="1032" class="Keyword">where</a>

  <a id="Steps.steps"></a><a id="1041" href="Algorithmic.Evaluation.html#1041" class="InductiveConstructor">steps</a> <a id="1047" class="Symbol">:</a> <a id="1049" class="Symbol">{</a><a id="1050" href="Algorithmic.Evaluation.html#1050" class="Bound">A</a> <a id="1052" class="Symbol">:</a> <a id="1054" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1056" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1061" href="Type.html#615" class="InductiveConstructor">*</a><a id="1062" class="Symbol">}</a> <a id="1064" class="Symbol">{</a><a id="1065" href="Algorithmic.Evaluation.html#1065" class="Bound">L</a> <a id="1067" href="Algorithmic.Evaluation.html#1067" class="Bound">N</a> <a id="1069" class="Symbol">:</a> <a id="1071" href="Algorithmic.html#1153" class="InductiveConstructor">∅</a> <a id="1073" href="Algorithmic.html#2242" class="Datatype Operator">⊢</a> <a id="1075" href="Algorithmic.Evaluation.html#1050" class="Bound">A</a><a id="1076" class="Symbol">}</a>
    <a id="1082" class="Symbol">→</a> <a id="1084" href="Algorithmic.Evaluation.html#1065" class="Bound">L</a> <a id="1086" href="Algorithmic.Reduction.html#9741" class="Datatype Operator">—↠</a> <a id="1089" href="Algorithmic.Evaluation.html#1067" class="Bound">N</a>
    <a id="1095" class="Symbol">→</a> <a id="1097" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="1106" href="Algorithmic.Evaluation.html#1067" class="Bound">N</a>
      <a id="1114" class="Comment">----------</a>
    <a id="1129" class="Symbol">→</a> <a id="1131" href="Algorithmic.Evaluation.html#993" class="Datatype">Steps</a> <a id="1137" href="Algorithmic.Evaluation.html#1065" class="Bound">L</a>


<a id="1141" class="Markup">\end{code}</a><a id="1151" class="Background">

</a><a id="1153" class="Markup">\begin{code}</a>
<a id="eval—→"></a><a id="1166" href="Algorithmic.Evaluation.html#1166" class="Function">eval—→</a>  <a id="1174" class="Symbol">:</a> <a id="1176" class="Symbol">∀{</a><a id="1178" href="Algorithmic.Evaluation.html#1178" class="Bound">A</a> <a id="1180" class="Symbol">:</a> <a id="1182" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1184" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1189" href="Type.html#615" class="InductiveConstructor">*</a><a id="1190" class="Symbol">}</a> <a id="1192" class="Symbol">→</a> <a id="1194" class="Symbol">{</a><a id="1195" href="Algorithmic.Evaluation.html#1195" class="Bound">t</a> <a id="1197" href="Algorithmic.Evaluation.html#1197" class="Bound">t&#39;</a> <a id="1200" class="Symbol">:</a> <a id="1202" href="Algorithmic.html#1153" class="InductiveConstructor">∅</a> <a id="1204" href="Algorithmic.html#2242" class="Datatype Operator">⊢</a> <a id="1206" href="Algorithmic.Evaluation.html#1178" class="Bound">A</a><a id="1207" class="Symbol">}</a> <a id="1209" class="Symbol">→</a> <a id="1211" href="Algorithmic.Evaluation.html#1195" class="Bound">t</a> <a id="1213" href="Algorithmic.Reduction.html#7616" class="Datatype Operator">—→</a> <a id="1216" href="Algorithmic.Evaluation.html#1197" class="Bound">t&#39;</a> <a id="1219" class="Symbol">→</a>
  <a id="1223" href="Algorithmic.Evaluation.html#993" class="Datatype">Steps</a> <a id="1229" href="Algorithmic.Evaluation.html#1197" class="Bound">t&#39;</a> <a id="1232" class="Symbol">→</a> <a id="1234" href="Algorithmic.Evaluation.html#993" class="Datatype">Steps</a> <a id="1240" href="Algorithmic.Evaluation.html#1195" class="Bound">t</a>
<a id="1242" href="Algorithmic.Evaluation.html#1166" class="Function">eval—→</a> <a id="1249" href="Algorithmic.Evaluation.html#1249" class="Bound">p</a> <a id="1251" class="Symbol">(</a><a id="1252" href="Algorithmic.Evaluation.html#1041" class="InductiveConstructor">steps</a> <a id="1258" href="Algorithmic.Evaluation.html#1258" class="Bound">ps</a> <a id="1261" href="Algorithmic.Evaluation.html#1261" class="Bound">q</a><a id="1262" class="Symbol">)</a> <a id="1264" class="Symbol">=</a> <a id="1266" href="Algorithmic.Evaluation.html#1041" class="InductiveConstructor">steps</a> <a id="1272" class="Symbol">(</a><a id="1273" href="Algorithmic.Reduction.html#9862" class="InductiveConstructor">trans—↠</a> <a id="1281" href="Algorithmic.Evaluation.html#1249" class="Bound">p</a> <a id="1283" href="Algorithmic.Evaluation.html#1258" class="Bound">ps</a><a id="1285" class="Symbol">)</a> <a id="1287" href="Algorithmic.Evaluation.html#1261" class="Bound">q</a>
<a id="1289" class="Markup">\end{code}</a><a id="1299" class="Background">

The evaluator takes gas and a term and returns the corresponding steps.
</a><a id="1373" class="Markup">\begin{code}</a>
<a id="eval"></a><a id="1386" href="Algorithmic.Evaluation.html#1386" class="Function">eval</a> <a id="1391" class="Symbol">:</a> <a id="1393" class="Symbol">∀</a> <a id="1395" class="Symbol">{</a><a id="1396" href="Algorithmic.Evaluation.html#1396" class="Bound">A</a> <a id="1398" class="Symbol">:</a> <a id="1400" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1402" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1407" href="Type.html#615" class="InductiveConstructor">*</a><a id="1408" class="Symbol">}</a> <a id="1410" class="Symbol">→</a> <a id="1412" href="Algorithmic.Evaluation.html#309" class="Datatype">Gas</a> <a id="1416" class="Symbol">→</a> <a id="1418" class="Symbol">(</a><a id="1419" href="Algorithmic.Evaluation.html#1419" class="Bound">M</a> <a id="1421" class="Symbol">:</a> <a id="1423" href="Algorithmic.html#1153" class="InductiveConstructor">∅</a> <a id="1425" href="Algorithmic.html#2242" class="Datatype Operator">⊢</a> <a id="1427" href="Algorithmic.Evaluation.html#1396" class="Bound">A</a><a id="1428" class="Symbol">)</a> <a id="1430" class="Symbol">→</a> <a id="1432" href="Algorithmic.Evaluation.html#993" class="Datatype">Steps</a> <a id="1438" href="Algorithmic.Evaluation.html#1419" class="Bound">M</a>
<a id="evalProg"></a><a id="1440" href="Algorithmic.Evaluation.html#1440" class="Function">evalProg</a> <a id="1449" class="Symbol">:</a> <a id="1451" class="Symbol">∀{</a><a id="1453" href="Algorithmic.Evaluation.html#1453" class="Bound">A</a> <a id="1455" class="Symbol">:</a> <a id="1457" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1459" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1464" href="Type.html#615" class="InductiveConstructor">*</a><a id="1465" class="Symbol">}</a> <a id="1467" class="Symbol">→</a> <a id="1469" href="Algorithmic.Evaluation.html#309" class="Datatype">Gas</a> <a id="1473" class="Symbol">→</a> <a id="1475" class="Symbol">{</a><a id="1476" href="Algorithmic.Evaluation.html#1476" class="Bound">t</a> <a id="1478" class="Symbol">:</a> <a id="1480" href="Algorithmic.html#1153" class="InductiveConstructor">∅</a> <a id="1482" href="Algorithmic.html#2242" class="Datatype Operator">⊢</a> <a id="1484" href="Algorithmic.Evaluation.html#1453" class="Bound">A</a><a id="1485" class="Symbol">}</a> <a id="1487" class="Symbol">→</a> <a id="1489" href="Algorithmic.Reduction.html#9997" class="Datatype">Progress</a> <a id="1498" href="Algorithmic.Evaluation.html#1476" class="Bound">t</a> <a id="1500" class="Symbol">→</a> <a id="1502" href="Algorithmic.Evaluation.html#993" class="Datatype">Steps</a> <a id="1508" href="Algorithmic.Evaluation.html#1476" class="Bound">t</a>

<a id="1511" href="Algorithmic.Evaluation.html#1386" class="Function">eval</a> <a id="1516" class="Symbol">(</a><a id="1517" href="Algorithmic.Evaluation.html#327" class="InductiveConstructor">gas</a> <a id="1521" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="1525" class="Symbol">)</a> <a id="1527" href="Algorithmic.Evaluation.html#1527" class="Bound">M</a> <a id="1529" class="Symbol">=</a> <a id="1531" href="Algorithmic.Evaluation.html#1041" class="InductiveConstructor">steps</a> <a id="1537" href="Algorithmic.Reduction.html#9806" class="InductiveConstructor">refl—↠</a> <a id="1544" href="Algorithmic.Evaluation.html#619" class="InductiveConstructor">out-of-gas</a>
<a id="1555" href="Algorithmic.Evaluation.html#1386" class="Function">eval</a> <a id="1560" class="Symbol">(</a><a id="1561" href="Algorithmic.Evaluation.html#327" class="InductiveConstructor">gas</a> <a id="1565" class="Symbol">(</a><a id="1566" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="1570" href="Algorithmic.Evaluation.html#1570" class="Bound">n</a><a id="1571" class="Symbol">))</a> <a id="1574" href="Algorithmic.Evaluation.html#1574" class="Bound">M</a> <a id="1576" class="Symbol">=</a> <a id="1578" href="Algorithmic.Evaluation.html#1440" class="Function">evalProg</a> <a id="1587" class="Symbol">(</a><a id="1588" href="Algorithmic.Evaluation.html#327" class="InductiveConstructor">gas</a> <a id="1592" href="Algorithmic.Evaluation.html#1570" class="Bound">n</a><a id="1593" class="Symbol">)</a> <a id="1595" class="Symbol">(</a><a id="1596" href="Algorithmic.Reduction.html#12750" class="Function">progress</a> <a id="1605" href="Algorithmic.Evaluation.html#1574" class="Bound">M</a><a id="1606" class="Symbol">)</a>

<a id="1609" href="Algorithmic.Evaluation.html#1440" class="Function">evalProg</a> <a id="1618" href="Algorithmic.Evaluation.html#1618" class="Bound">g</a> <a id="1620" class="Symbol">(</a><a id="1621" href="Algorithmic.Reduction.html#10053" class="InductiveConstructor">step</a> <a id="1626" class="Symbol">{</a><a id="1627" class="Argument">N</a> <a id="1629" class="Symbol">=</a> <a id="1631" href="Algorithmic.Evaluation.html#1631" class="Bound">t&#39;</a><a id="1633" class="Symbol">}</a> <a id="1635" href="Algorithmic.Evaluation.html#1635" class="Bound">p</a><a id="1636" class="Symbol">)</a>  <a id="1639" class="Symbol">=</a> <a id="1641" href="Algorithmic.Evaluation.html#1166" class="Function">eval—→</a> <a id="1648" href="Algorithmic.Evaluation.html#1635" class="Bound">p</a> <a id="1650" class="Symbol">(</a><a id="1651" href="Algorithmic.Evaluation.html#1386" class="Function">eval</a> <a id="1656" href="Algorithmic.Evaluation.html#1618" class="Bound">g</a> <a id="1658" href="Algorithmic.Evaluation.html#1631" class="Bound">t&#39;</a><a id="1660" class="Symbol">)</a>
<a id="1662" href="Algorithmic.Evaluation.html#1440" class="Function">evalProg</a> <a id="1671" href="Algorithmic.Evaluation.html#1671" class="Bound">g</a> <a id="1673" class="Symbol">(</a><a id="1674" href="Algorithmic.Reduction.html#10117" class="InductiveConstructor">done</a> <a id="1679" href="Algorithmic.Evaluation.html#1679" class="Bound">VM</a><a id="1681" class="Symbol">)</a> <a id="1683" class="Symbol">=</a> <a id="1685" href="Algorithmic.Evaluation.html#1041" class="InductiveConstructor">steps</a> <a id="1691" href="Algorithmic.Reduction.html#9806" class="InductiveConstructor">refl—↠</a> <a id="1698" class="Symbol">(</a><a id="1699" href="Algorithmic.Evaluation.html#550" class="InductiveConstructor">done</a> <a id="1704" class="Symbol">_</a> <a id="1706" href="Algorithmic.Evaluation.html#1679" class="Bound">VM</a><a id="1708" class="Symbol">)</a>
<a id="1710" href="Algorithmic.Evaluation.html#1440" class="Function">evalProg</a> <a id="1719" href="Algorithmic.Evaluation.html#1719" class="Bound">g</a> <a id="1721" class="Symbol">(</a><a id="1722" href="Algorithmic.Reduction.html#10237" class="InductiveConstructor">error</a> <a id="1728" href="Algorithmic.Evaluation.html#1728" class="Bound">e</a><a id="1729" class="Symbol">)</a> <a id="1731" class="Symbol">=</a> <a id="1733" href="Algorithmic.Evaluation.html#1041" class="InductiveConstructor">steps</a> <a id="1739" href="Algorithmic.Reduction.html#9806" class="InductiveConstructor">refl—↠</a> <a id="1746" class="Symbol">(</a><a id="1747" href="Algorithmic.Evaluation.html#680" class="InductiveConstructor">error</a> <a id="1753" href="Algorithmic.Evaluation.html#1728" class="Bound">e</a><a id="1754" class="Symbol">)</a>
<a id="1756" href="Algorithmic.Evaluation.html#1440" class="Function">evalProg</a> <a id="1765" href="Algorithmic.Evaluation.html#1765" class="Bound">g</a> <a id="1767" class="Symbol">(</a><a id="1768" href="Algorithmic.Reduction.html#10174" class="InductiveConstructor">neutral</a> <a id="1776" href="Algorithmic.Evaluation.html#1776" class="Bound">p</a><a id="1777" class="Symbol">)</a> <a id="1779" class="Symbol">=</a> <a id="1781" href="Algorithmic.Evaluation.html#1041" class="InductiveConstructor">steps</a> <a id="1787" href="Algorithmic.Reduction.html#9806" class="InductiveConstructor">refl—↠</a> <a id="1794" class="Symbol">(</a><a id="1795" href="Algorithmic.Evaluation.html#760" class="InductiveConstructor">neutral</a> <a id="1803" href="Algorithmic.Evaluation.html#1776" class="Bound">p</a><a id="1804" class="Symbol">)</a>
<a id="1806" class="Markup">\end{code}</a><a id="1816" class="Background">
</a></pre></body></html>