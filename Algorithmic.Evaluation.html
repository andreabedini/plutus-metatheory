<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Algorithmic.Evaluation</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Markup">\begin{code}</a>
<a id="14" class="Keyword">module</a> <a id="21" href="Algorithmic.Evaluation.html" class="Module">Algorithmic.Evaluation</a> <a id="44" class="Keyword">where</a>
<a id="50" class="Markup">\end{code}</a><a id="60" class="Background">

## Imports

</a><a id="74" class="Markup">\begin{code}</a>
<a id="87" class="Keyword">open</a> <a id="92" class="Keyword">import</a> <a id="99" href="Type.html" class="Module">Type</a>
<a id="104" class="Keyword">open</a> <a id="109" class="Keyword">import</a> <a id="116" href="Type.BetaNormal.html" class="Module">Type.BetaNormal</a>
<a id="132" class="Keyword">open</a> <a id="137" class="Keyword">import</a> <a id="144" href="Algorithmic.html" class="Module">Algorithmic</a>
<a id="156" class="Keyword">open</a> <a id="161" class="Keyword">import</a> <a id="168" href="Algorithmic.Reduction.html" class="Module">Algorithmic.Reduction</a>
<a id="190" class="Markup">\end{code}</a><a id="200" class="Background">

## Evaluation

As previously, gas is specified by a natural number.
</a><a id="270" class="Markup">\begin{code}</a>
<a id="283" class="Keyword">open</a> <a id="288" class="Keyword">import</a> <a id="295" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="304" class="Keyword">data</a> <a id="Gas"></a><a id="309" href="Algorithmic.Evaluation.html#309" class="Datatype">Gas</a> <a id="313" class="Symbol">:</a> <a id="315" class="PrimitiveType">Set</a> <a id="319" class="Keyword">where</a>
  <a id="Gas.gas"></a><a id="327" href="Algorithmic.Evaluation.html#327" class="InductiveConstructor">gas</a> <a id="331" class="Symbol">:</a> <a id="333" href="Agda.Builtin.Nat.html#165" class="Datatype">ℕ</a> <a id="335" class="Symbol">→</a> <a id="337" href="Algorithmic.Evaluation.html#309" class="Datatype">Gas</a>
<a id="341" class="Markup">\end{code}</a><a id="351" class="Background">
When our evaluator returns a term `N`, it will either give evidence that
`N` is a value or indicate that it ran out of gas.
</a><a id="476" class="Markup">\begin{code}</a>
<a id="489" class="Keyword">data</a> <a id="Finished"></a><a id="494" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="503" class="Symbol">{</a><a id="504" href="Algorithmic.Evaluation.html#504" class="Bound">A</a> <a id="506" class="Symbol">:</a> <a id="508" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="510" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="515" href="Type.html#615" class="InductiveConstructor">*</a><a id="516" class="Symbol">}</a> <a id="518" class="Symbol">:</a>  <a id="521" class="Symbol">(</a><a id="522" href="Algorithmic.Evaluation.html#522" class="Bound">N</a> <a id="524" class="Symbol">:</a> <a id="526" href="Algorithmic.html#1152" class="InductiveConstructor">∅</a> <a id="528" href="Algorithmic.html#2241" class="Datatype Operator">⊢</a> <a id="530" href="Algorithmic.Evaluation.html#504" class="Bound">A</a><a id="531" class="Symbol">)</a> <a id="533" class="Symbol">→</a>  <a id="536" class="PrimitiveType">Set</a> <a id="540" class="Keyword">where</a>

   <a id="Finished.done"></a><a id="550" href="Algorithmic.Evaluation.html#550" class="InductiveConstructor">done</a> <a id="555" class="Symbol">:</a> <a id="557" class="Symbol">∀</a> <a id="559" href="Algorithmic.Evaluation.html#559" class="Bound">N</a> <a id="561" class="Symbol">→</a> 
       <a id="571" href="Algorithmic.Reduction.html#1087" class="Datatype">Value</a> <a id="577" href="Algorithmic.Evaluation.html#559" class="Bound">N</a>
       <a id="586" class="Comment">----------</a>
     <a id="602" class="Symbol">→</a> <a id="604" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="613" href="Algorithmic.Evaluation.html#559" class="Bound">N</a>

   <a id="Finished.out-of-gas"></a><a id="619" href="Algorithmic.Evaluation.html#619" class="InductiveConstructor">out-of-gas</a> <a id="630" class="Symbol">:</a> <a id="632" class="Symbol">∀{</a><a id="634" href="Algorithmic.Evaluation.html#634" class="Bound">N</a><a id="635" class="Symbol">}</a> <a id="637" class="Symbol">→</a> 
       <a id="647" class="Comment">----------</a>
       <a id="665" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="674" href="Algorithmic.Evaluation.html#634" class="Bound">N</a>

   <a id="Finished.error"></a><a id="680" href="Algorithmic.Evaluation.html#680" class="InductiveConstructor">error</a> <a id="686" class="Symbol">:</a> <a id="688" class="Symbol">{</a><a id="689" href="Algorithmic.Evaluation.html#689" class="Bound">L</a> <a id="691" class="Symbol">:</a> <a id="693" href="Algorithmic.html#1152" class="InductiveConstructor">∅</a> <a id="695" href="Algorithmic.html#2241" class="Datatype Operator">⊢</a> <a id="697" href="Algorithmic.Evaluation.html#504" class="Bound">A</a><a id="698" class="Symbol">}</a> <a id="700" class="Symbol">→</a> <a id="702" href="Algorithmic.Reduction.html#1795" class="Datatype">Error</a> <a id="708" href="Algorithmic.Evaluation.html#689" class="Bound">L</a> <a id="710" class="Symbol">→</a> <a id="712" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="721" href="Algorithmic.Evaluation.html#689" class="Bound">L</a>

   <a id="727" class="Comment">-- is this actually possible?</a>
<a id="757" class="Comment">--   neutral : {L : ∅ ⊢ A} → Neutral L → Finished L</a>
<a id="809" class="Markup">\end{code}</a><a id="819" class="Background">
Given a term `L` of type `A`, the evaluator will, for some `N`, return
a reduction sequence from `L` to `N` and an indication of whether
reduction finished.
</a><a id="977" class="Markup">\begin{code}</a>
<a id="990" class="Keyword">data</a> <a id="Steps"></a><a id="995" href="Algorithmic.Evaluation.html#995" class="Datatype">Steps</a> <a id="1001" class="Symbol">:</a> <a id="1003" class="Symbol">∀</a> <a id="1005" class="Symbol">{</a><a id="1006" href="Algorithmic.Evaluation.html#1006" class="Bound">A</a> <a id="1008" class="Symbol">:</a> <a id="1010" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1012" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1017" href="Type.html#615" class="InductiveConstructor">*</a><a id="1018" class="Symbol">}</a> <a id="1020" class="Symbol">→</a> <a id="1022" href="Algorithmic.html#1152" class="InductiveConstructor">∅</a> <a id="1024" href="Algorithmic.html#2241" class="Datatype Operator">⊢</a> <a id="1026" href="Algorithmic.Evaluation.html#1006" class="Bound">A</a> <a id="1028" class="Symbol">→</a> <a id="1030" class="PrimitiveType">Set</a> <a id="1034" class="Keyword">where</a>

  <a id="Steps.steps"></a><a id="1043" href="Algorithmic.Evaluation.html#1043" class="InductiveConstructor">steps</a> <a id="1049" class="Symbol">:</a> <a id="1051" class="Symbol">{</a><a id="1052" href="Algorithmic.Evaluation.html#1052" class="Bound">A</a> <a id="1054" class="Symbol">:</a> <a id="1056" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1058" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1063" href="Type.html#615" class="InductiveConstructor">*</a><a id="1064" class="Symbol">}</a> <a id="1066" class="Symbol">{</a><a id="1067" href="Algorithmic.Evaluation.html#1067" class="Bound">L</a> <a id="1069" href="Algorithmic.Evaluation.html#1069" class="Bound">N</a> <a id="1071" class="Symbol">:</a> <a id="1073" href="Algorithmic.html#1152" class="InductiveConstructor">∅</a> <a id="1075" href="Algorithmic.html#2241" class="Datatype Operator">⊢</a> <a id="1077" href="Algorithmic.Evaluation.html#1052" class="Bound">A</a><a id="1078" class="Symbol">}</a>
    <a id="1084" class="Symbol">→</a> <a id="1086" href="Algorithmic.Evaluation.html#1067" class="Bound">L</a> <a id="1088" href="Algorithmic.Reduction.html#8516" class="Datatype Operator">—↠</a> <a id="1091" href="Algorithmic.Evaluation.html#1069" class="Bound">N</a>
    <a id="1097" class="Symbol">→</a> <a id="1099" href="Algorithmic.Evaluation.html#494" class="Datatype">Finished</a> <a id="1108" href="Algorithmic.Evaluation.html#1069" class="Bound">N</a>
      <a id="1116" class="Comment">----------</a>
    <a id="1131" class="Symbol">→</a> <a id="1133" href="Algorithmic.Evaluation.html#995" class="Datatype">Steps</a> <a id="1139" href="Algorithmic.Evaluation.html#1067" class="Bound">L</a>


<a id="1143" class="Markup">\end{code}</a><a id="1153" class="Background">

</a><a id="1155" class="Markup">\begin{code}</a>
<a id="eval—→"></a><a id="1168" href="Algorithmic.Evaluation.html#1168" class="Function">eval—→</a>  <a id="1176" class="Symbol">:</a> <a id="1178" class="Symbol">∀{</a><a id="1180" href="Algorithmic.Evaluation.html#1180" class="Bound">A</a> <a id="1182" class="Symbol">:</a> <a id="1184" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1186" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1191" href="Type.html#615" class="InductiveConstructor">*</a><a id="1192" class="Symbol">}</a> <a id="1194" class="Symbol">→</a> <a id="1196" class="Symbol">{</a><a id="1197" href="Algorithmic.Evaluation.html#1197" class="Bound">t</a> <a id="1199" href="Algorithmic.Evaluation.html#1199" class="Bound">t&#39;</a> <a id="1202" class="Symbol">:</a> <a id="1204" href="Algorithmic.html#1152" class="InductiveConstructor">∅</a> <a id="1206" href="Algorithmic.html#2241" class="Datatype Operator">⊢</a> <a id="1208" href="Algorithmic.Evaluation.html#1180" class="Bound">A</a><a id="1209" class="Symbol">}</a> <a id="1211" class="Symbol">→</a> <a id="1213" href="Algorithmic.Evaluation.html#1197" class="Bound">t</a> <a id="1215" href="Algorithmic.Reduction.html#6391" class="Datatype Operator">—→</a> <a id="1218" href="Algorithmic.Evaluation.html#1199" class="Bound">t&#39;</a> <a id="1221" class="Symbol">→</a>
  <a id="1225" href="Algorithmic.Evaluation.html#995" class="Datatype">Steps</a> <a id="1231" href="Algorithmic.Evaluation.html#1199" class="Bound">t&#39;</a> <a id="1234" class="Symbol">→</a> <a id="1236" href="Algorithmic.Evaluation.html#995" class="Datatype">Steps</a> <a id="1242" href="Algorithmic.Evaluation.html#1197" class="Bound">t</a>
<a id="1244" href="Algorithmic.Evaluation.html#1168" class="Function">eval—→</a> <a id="1251" href="Algorithmic.Evaluation.html#1251" class="Bound">p</a> <a id="1253" class="Symbol">(</a><a id="1254" href="Algorithmic.Evaluation.html#1043" class="InductiveConstructor">steps</a> <a id="1260" href="Algorithmic.Evaluation.html#1260" class="Bound">ps</a> <a id="1263" href="Algorithmic.Evaluation.html#1263" class="Bound">q</a><a id="1264" class="Symbol">)</a> <a id="1266" class="Symbol">=</a> <a id="1268" href="Algorithmic.Evaluation.html#1043" class="InductiveConstructor">steps</a> <a id="1274" class="Symbol">(</a><a id="1275" href="Algorithmic.Reduction.html#8637" class="InductiveConstructor">trans—↠</a> <a id="1283" href="Algorithmic.Evaluation.html#1251" class="Bound">p</a> <a id="1285" href="Algorithmic.Evaluation.html#1260" class="Bound">ps</a><a id="1287" class="Symbol">)</a> <a id="1289" href="Algorithmic.Evaluation.html#1263" class="Bound">q</a>
<a id="1291" class="Markup">\end{code}</a><a id="1301" class="Background">

The evaluator takes gas and a term and returns the corresponding steps.
</a><a id="1375" class="Markup">\begin{code}</a>
<a id="eval"></a><a id="1388" href="Algorithmic.Evaluation.html#1388" class="Function">eval</a> <a id="1393" class="Symbol">:</a> <a id="1395" class="Symbol">∀</a> <a id="1397" class="Symbol">{</a><a id="1398" href="Algorithmic.Evaluation.html#1398" class="Bound">A</a> <a id="1400" class="Symbol">:</a> <a id="1402" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1404" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1409" href="Type.html#615" class="InductiveConstructor">*</a><a id="1410" class="Symbol">}</a> <a id="1412" class="Symbol">→</a> <a id="1414" href="Algorithmic.Evaluation.html#309" class="Datatype">Gas</a> <a id="1418" class="Symbol">→</a> <a id="1420" class="Symbol">(</a><a id="1421" href="Algorithmic.Evaluation.html#1421" class="Bound">M</a> <a id="1423" class="Symbol">:</a> <a id="1425" href="Algorithmic.html#1152" class="InductiveConstructor">∅</a> <a id="1427" href="Algorithmic.html#2241" class="Datatype Operator">⊢</a> <a id="1429" href="Algorithmic.Evaluation.html#1398" class="Bound">A</a><a id="1430" class="Symbol">)</a> <a id="1432" class="Symbol">→</a> <a id="1434" href="Algorithmic.Evaluation.html#995" class="Datatype">Steps</a> <a id="1440" href="Algorithmic.Evaluation.html#1421" class="Bound">M</a>
<a id="evalProg"></a><a id="1442" href="Algorithmic.Evaluation.html#1442" class="Function">evalProg</a> <a id="1451" class="Symbol">:</a> <a id="1453" class="Symbol">∀{</a><a id="1455" href="Algorithmic.Evaluation.html#1455" class="Bound">A</a> <a id="1457" class="Symbol">:</a> <a id="1459" href="Type.html#885" class="InductiveConstructor">∅</a> <a id="1461" href="Type.BetaNormal.html#885" class="Datatype Operator">⊢Nf⋆</a> <a id="1466" href="Type.html#615" class="InductiveConstructor">*</a><a id="1467" class="Symbol">}</a> <a id="1469" class="Symbol">→</a> <a id="1471" href="Algorithmic.Evaluation.html#309" class="Datatype">Gas</a> <a id="1475" class="Symbol">→</a> <a id="1477" class="Symbol">{</a><a id="1478" href="Algorithmic.Evaluation.html#1478" class="Bound">t</a> <a id="1480" class="Symbol">:</a> <a id="1482" href="Algorithmic.html#1152" class="InductiveConstructor">∅</a> <a id="1484" href="Algorithmic.html#2241" class="Datatype Operator">⊢</a> <a id="1486" href="Algorithmic.Evaluation.html#1455" class="Bound">A</a><a id="1487" class="Symbol">}</a> <a id="1489" class="Symbol">→</a> <a id="1491" href="Algorithmic.Reduction.html#8772" class="Datatype">Progress</a> <a id="1500" href="Algorithmic.Evaluation.html#1478" class="Bound">t</a> <a id="1502" class="Symbol">→</a> <a id="1504" href="Algorithmic.Evaluation.html#995" class="Datatype">Steps</a> <a id="1510" href="Algorithmic.Evaluation.html#1478" class="Bound">t</a>

<a id="1513" href="Algorithmic.Evaluation.html#1388" class="Function">eval</a> <a id="1518" class="Symbol">(</a><a id="1519" href="Algorithmic.Evaluation.html#327" class="InductiveConstructor">gas</a> <a id="1523" href="Agda.Builtin.Nat.html#183" class="InductiveConstructor">zero</a><a id="1527" class="Symbol">)</a> <a id="1529" href="Algorithmic.Evaluation.html#1529" class="Bound">M</a> <a id="1531" class="Symbol">=</a> <a id="1533" href="Algorithmic.Evaluation.html#1043" class="InductiveConstructor">steps</a> <a id="1539" href="Algorithmic.Reduction.html#8581" class="InductiveConstructor">refl—↠</a> <a id="1546" href="Algorithmic.Evaluation.html#619" class="InductiveConstructor">out-of-gas</a>
<a id="1557" href="Algorithmic.Evaluation.html#1388" class="Function">eval</a> <a id="1562" class="Symbol">(</a><a id="1563" href="Algorithmic.Evaluation.html#327" class="InductiveConstructor">gas</a> <a id="1567" class="Symbol">(</a><a id="1568" href="Agda.Builtin.Nat.html#196" class="InductiveConstructor">suc</a> <a id="1572" href="Algorithmic.Evaluation.html#1572" class="Bound">n</a><a id="1573" class="Symbol">))</a> <a id="1576" href="Algorithmic.Evaluation.html#1576" class="Bound">M</a> <a id="1578" class="Symbol">=</a> <a id="1580" href="Algorithmic.Evaluation.html#1442" class="Function">evalProg</a> <a id="1589" class="Symbol">(</a><a id="1590" href="Algorithmic.Evaluation.html#327" class="InductiveConstructor">gas</a> <a id="1594" href="Algorithmic.Evaluation.html#1572" class="Bound">n</a><a id="1595" class="Symbol">)</a> <a id="1597" class="Symbol">(</a><a id="1598" href="Algorithmic.Reduction.html#11107" class="Function">progress</a> <a id="1607" class="Symbol">_</a> <a id="1609" href="Algorithmic.Evaluation.html#1576" class="Bound">M</a><a id="1610" class="Symbol">)</a>

<a id="1613" href="Algorithmic.Evaluation.html#1442" class="Function">evalProg</a> <a id="1622" href="Algorithmic.Evaluation.html#1622" class="Bound">g</a> <a id="1624" class="Symbol">(</a><a id="1625" href="Algorithmic.Reduction.html#8828" class="InductiveConstructor">step</a> <a id="1630" class="Symbol">{</a><a id="1631" class="Argument">N</a> <a id="1633" class="Symbol">=</a> <a id="1635" href="Algorithmic.Evaluation.html#1635" class="Bound">t&#39;</a><a id="1637" class="Symbol">}</a> <a id="1639" href="Algorithmic.Evaluation.html#1639" class="Bound">p</a><a id="1640" class="Symbol">)</a>  <a id="1643" class="Symbol">=</a> <a id="1645" href="Algorithmic.Evaluation.html#1168" class="Function">eval—→</a> <a id="1652" href="Algorithmic.Evaluation.html#1639" class="Bound">p</a> <a id="1654" class="Symbol">(</a><a id="1655" href="Algorithmic.Evaluation.html#1388" class="Function">eval</a> <a id="1660" href="Algorithmic.Evaluation.html#1622" class="Bound">g</a> <a id="1662" href="Algorithmic.Evaluation.html#1635" class="Bound">t&#39;</a><a id="1664" class="Symbol">)</a>
<a id="1666" href="Algorithmic.Evaluation.html#1442" class="Function">evalProg</a> <a id="1675" href="Algorithmic.Evaluation.html#1675" class="Bound">g</a> <a id="1677" class="Symbol">(</a><a id="1678" href="Algorithmic.Reduction.html#8892" class="InductiveConstructor">done</a> <a id="1683" href="Algorithmic.Evaluation.html#1683" class="Bound">VM</a><a id="1685" class="Symbol">)</a> <a id="1687" class="Symbol">=</a> <a id="1689" href="Algorithmic.Evaluation.html#1043" class="InductiveConstructor">steps</a> <a id="1695" href="Algorithmic.Reduction.html#8581" class="InductiveConstructor">refl—↠</a> <a id="1702" class="Symbol">(</a><a id="1703" href="Algorithmic.Evaluation.html#550" class="InductiveConstructor">done</a> <a id="1708" class="Symbol">_</a> <a id="1710" href="Algorithmic.Evaluation.html#1683" class="Bound">VM</a><a id="1712" class="Symbol">)</a>
<a id="1714" href="Algorithmic.Evaluation.html#1442" class="Function">evalProg</a> <a id="1723" href="Algorithmic.Evaluation.html#1723" class="Bound">g</a> <a id="1725" class="Symbol">(</a><a id="1726" href="Algorithmic.Reduction.html#8950" class="InductiveConstructor">error</a> <a id="1732" href="Algorithmic.Evaluation.html#1732" class="Bound">e</a><a id="1733" class="Symbol">)</a> <a id="1735" class="Symbol">=</a> <a id="1737" href="Algorithmic.Evaluation.html#1043" class="InductiveConstructor">steps</a> <a id="1743" href="Algorithmic.Reduction.html#8581" class="InductiveConstructor">refl—↠</a> <a id="1750" class="Symbol">(</a><a id="1751" href="Algorithmic.Evaluation.html#680" class="InductiveConstructor">error</a> <a id="1757" href="Algorithmic.Evaluation.html#1732" class="Bound">e</a><a id="1758" class="Symbol">)</a>
<a id="1760" class="Comment">--evalProg g (neutral p) = steps refl—↠ (neutral p)</a>
<a id="1812" class="Markup">\end{code}</a><a id="1822" class="Background">
</a></pre></body></html>